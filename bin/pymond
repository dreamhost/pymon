#!/usr/bin/env python2.4

import os
import sys
import string
import pwd, grp

if sys.version_info[0:3] < (2,4):
    print "For some reason, you are not running python 2.4."
    print "pymon must be run under python 2.4."
    sys.exit()

from twisted.application import app
from twisted.scripts.twistd import runApp, ServerOptions

try:
    from pymon.config import cfg
except ImportError:
    from pkg_resources import require
    require('PyMonitor')
    from pymon.config import cfg

uid = pwd.getpwnam(cfg.user)[2]
gid = grp.getgrnam(cfg.group)[2]

tac = os.path.join('bin', 'pymon.tac')
if not os.path.exists(tac):
    tac = os.path.join(cfg.prefix, tac)

sys.argv[0] = 'twistd'
if os.path.exists(cfg.prefix):
    sys.argv.extend([
        '--rundir=%s' % cfg.prefix])
    
sys.argv.extend([
    '--uid=%s' % uid,
    '--gid=%s' % gid,
    '-noy',
    tac
])
print ' '.join(sys.argv)
app.run(runApp, ServerOptions)

